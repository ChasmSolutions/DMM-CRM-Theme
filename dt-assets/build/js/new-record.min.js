jQuery((function($){let new_post={};$(".type-option").on("click",(function(){let type=$(this).attr("id");$(".type-option.selected").removeClass("selected"),$(this).addClass("selected"),$(`#${type} input`).prop("checked",!0),$(".form-fields").show(),$(".form-field").hide(),$(".type-control-field").hide(),$(".form-field.all").show(),$(`.form-field.${type}`).show(),$("#show-shield-banner").show(),new_post.type=type})),$("#show-hidden-fields").on("click",(function(){$(".form-field").show(),$("#show-shield-banner").hide()})),$(".js-create-post-button").removeAttr("disabled"),$("button.add-button").on("click",(e=>{const listClass=$(e.currentTarget).data("list-class");$(`#edit-${listClass}`).append(`<li style="display: flex">\n              <input type="text" class="dt-communication-channel" data-field="${window.lodash.escape(listClass)}"/>\n              <button class="button clear delete-button new-${window.lodash.escape(listClass)}" type="button">\n                  <img src="${window.lodash.escape(window.wpApiShare.template_dir)}/dt-assets/images/invalid.svg">\n              </button>\n            </li>`)})),$("button.dt_multi_select").on("click",(function(){let fieldKey=$(this).data("field-key"),optionKey=$(this).attr("id"),field=jQuery(`[data-field-key="${fieldKey}"]#${optionKey}`);field.hasClass("selected-select-button")?(field.addClass("empty-select-button"),field.removeClass("selected-select-button")):(field.removeClass("empty-select-button"),field.addClass("selected-select-button"))})),$(".js-create-post").on("click",".delete-button",(function(){$(this).parent().remove()})),$(".dt_date_picker").datepicker({constrainInput:!1,dateFormat:"yy-mm-dd",onClose:function(date){date=window.SHAREDFUNCTIONS.convertArabicToEnglishNumbers(date),$(this).val()||(date=" ");let id=$(this).attr("id");new_post[id]=date,this.value=window.SHAREDFUNCTIONS.formatDate(moment.utc(date).unix())},changeMonth:!0,changeYear:!0,yearRange:"1900:2050"}),$(".js-create-post").on("submit",(function(){return $(".js-create-post-button").attr("disabled",!0).addClass("loading"),new_post.title=$(".js-create-post input[name=title]").val(),$(".select-field").each(((index,entry)=>{$(entry).val()&&(new_post[$(entry).attr("id")]=$(entry).val())})),$(".text-input").each(((index,entry)=>{$(entry).val()&&(new_post[$(entry).attr("id")]=$(entry).val())})),$(".dt-communication-channel").each(((index,entry)=>{let channel=$(entry).data("field");new_post[channel]||(new_post[channel]=[]),new_post[channel].push({value:$(entry).val()})})),$(".selected-select-button").each(((index,entry)=>{let optionKey=$(entry).attr("id"),fieldKey=$(entry).data("field-key");new_post[fieldKey]||(new_post[fieldKey]={values:[]}),new_post[fieldKey].values.push({value:optionKey})})),void 0!==window.selected_location_grid_meta&&(new_post.location_grid_meta=window.selected_location_grid_meta.location_grid_meta),API.create_post(window.new_record_localized.post_type,new_post).promise().then((function(data){window.location=data.permalink})).catch((function(error){$(".js-create-post-button").removeClass("loading").addClass("alert"),$(".js-create-post").append($("<div>").html(error.responseText)),console.error(error)})),!1})),$(".typeahead__query input").each(((key,el)=>{let field_key=$(el).data("field"),post_type=$(el).data("post_type"),field_type=$(el).data("field_type");typeaheadTotals={},window.Typeahead[`.js-typeahead-${field_key}`]||("connection"===field_type?$.typeahead({input:`.js-typeahead-${field_key}`,minLength:0,accent:!0,searchOnFocus:!0,maxItem:20,template:function(query,item){return`<span dir="auto">${window.lodash.escape(item.name)} (#${window.lodash.escape(item.ID)})</span>`},source:TYPEAHEADS.typeaheadPostsSource(post_type),display:"name",templateValue:"{{name}}",dynamic:!0,multiselect:{matchOn:["ID"],data:[],callback:{onCancel:function(node,item){window.lodash.pullAllBy(new_post[field_key].values,[{value:item.ID}],"value")}}},callback:{onResult:function(node,query,result,resultCount){let text=TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$(`#${field_key}-result-container`).html(text)},onHideLayout:function(){$(`#${field_key}-result-container`).html("")},onClick:function(node,a,item,event){new_post[field_key]||(new_post[field_key]={values:[]}),new_post[field_key].values.push({value:item.ID}),this.addMultiselectItemLayout(item),event.preventDefault(),this.hideLayout(),this.resetInput()}}}):"location"===field_type&&$.typeahead({input:".js-typeahead-location_grid",minLength:0,accent:!0,searchOnFocus:!0,maxItem:20,dropdownFilter:[{key:"group",value:"focus",template:window.lodash.escape(window.wpApiShare.translations.regions_of_focus),all:window.lodash.escape(window.wpApiShare.translations.all_locations)}],source:{focus:{display:"name",ajax:{url:window.wpApiShare.root+"dt/v1/mapping_module/search_location_grid_by_name",data:{s:"{{query}}",filter:function(){return window.lodash.get(window.Typeahead[".js-typeahead-location_grid"].filters.dropdown,"value","all")}},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",window.wpApiShare.nonce)},callback:{done:function(data){return"undefined"!=typeof typeaheadTotals&&(typeaheadTotals.field=data.total),data.location_grid}}}}},display:"name",templateValue:"{{name}}",dynamic:!0,multiselect:{matchOn:["ID"],data:[],callback:{onCancel:function(node,item){window.lodash.pullAllBy(new_post[field_key].values,[{value:item.ID}],"value")}}},callback:{onClick:function(node,a,item,event){new_post[field_key]||(new_post[field_key]={values:[]}),new_post[field_key].values.push({value:item.ID}),this.addMultiselectItemLayout(item),event.preventDefault(),this.hideLayout(),this.resetInput()},onReady(){this.filters.dropdown={key:"group",value:"focus",template:window.lodash.escape(window.wpApiShare.translations.regions_of_focus)},this.container.removeClass("filter").find("."+this.options.selector.filterButton).html(window.lodash.escape(window.wpApiShare.translations.regions_of_focus))},onResult:function(node,query,result,resultCount){resultCount=typeaheadTotals.location_grid;let text=TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$("#location_grid-result-container").html(text)},onHideLayout:function(){$("#location_grid-result-container").html("")}}}))}));let field_settings=window.new_record_localized.post_type_settings.fields;for(let input of $(".multi_select .typeahead__query input")){let field=$(input).data("field"),typeahead_name=`.js-typeahead-${field}`;if(window.Typeahead[typeahead_name])return;let source_data={data:[]},field_options=window.lodash.get(field_settings,`${field}.default`,{});Object.keys(field_options).length>0?window.lodash.forOwn(field_options,((val,key)=>{val.deleted||source_data.data.push({key:key,name:key,value:val.label||key})})):source_data={[field]:{display:["value"],ajax:{url:window.wpApiShare.root+`dt-posts/v2/${post_type}/multi-select-values`,data:{s:"{{query}}",field:field},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",window.wpApiShare.nonce)},callback:{done:function(data){return(data||[]).map((tag=>({value:window.lodash.get(field_options,tag+".label",tag),key:tag})))}}}}},$.typeahead({input:`.js-typeahead-${field}`,minLength:0,maxItem:20,searchOnFocus:!0,template:function(query,item){return`<span>${window.lodash.escape(item.value)}</span>`},source:source_data,display:"value",templateValue:"{{value}}",dynamic:!0,multiselect:{matchOn:["key"],data:[],callback:{onCancel:function(node,item,event){window.lodash.pullAllBy(new_post[field].values,[{value:item.key}],"value")}}},callback:{onClick:function(node,a,item,event){new_post[field]||(new_post[field]={values:[]}),new_post[field].values.push({value:item.key}),this.addMultiselectItemLayout(item),event.preventDefault(),this.hideLayout(),this.resetInput()},onResult:function(node,query,result,resultCount){let text=TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$(`#${field}-result-container`).html(text)},onHideLayout:function(){$(`#${field}-result-container`).html("")}}})}}));
//# sourceMappingURL=new-record.min.js.map
