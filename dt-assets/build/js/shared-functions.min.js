function makeRequest(type,url,data,base="dt/v1/"){const options={type:type,contentType:"application/json; charset=utf-8",dataType:"json",url:url.startsWith("http")?url:`${wpApiShare.root}${base}${url}`,beforeSend:xhr=>{xhr.setRequestHeader("X-WP-Nonce",wpApiShare.nonce)}};return data&&(options.data="GET"===type?data:JSON.stringify(data)),jQuery.ajax(options)}function makeRequestOnPosts(type,url,data){const options={type:type,contentType:"application/json; charset=utf-8",dataType:"json",url:url.startsWith("http")?url:`${wpApiShare.root}dt-posts/v2/${url}`,beforeSend:xhr=>{xhr.setRequestHeader("X-WP-Nonce",wpApiShare.nonce)}};return data&&!window.lodash.isEmpty(data)&&(options.data="GET"===type?data:JSON.stringify(data)),jQuery.ajax(options)}function handleAjaxError(err){"abortPromise"!==window.lodash.get(err,"statusText")&&err.responseText&&(console.trace("error"),console.log(err))}_=_||window.lodash,jQuery(document).ready((function($){let ref="";ref=wpApiShare&&wpApiShare.site_url?window.location.href.replace(wpApiShare.site_url+"/",""):window.location.pathname;let page=""+(ref.replace(wpApiShare.site_url,"").split("/")[0]+"");$(`div.top-bar-left ul.menu [href^="${wpApiShare.site_url+"/"+page}"]`).parent().addClass("active");let collapsed_tiles=window.SHAREDFUNCTIONS.get_json_cookie("collapsed_tiles");$(".section-header .section-chevron").on("click",(function(){let tile=$(this).closest(".bordered-box");tile.toggleClass("collapsed");let tile_id=tile.attr("id");tile_id&&tile_id.includes("-tile")&&(collapsed_tiles.includes(tile_id)?collapsed_tiles=window.lodash.pull(collapsed_tiles,tile_id):collapsed_tiles.push(tile_id),window.SHAREDFUNCTIONS.save_json_cookie("collapsed_tiles",collapsed_tiles,wpApiShare.post_type)),$(".grid").masonry("layout")})),$(".bordered-box").each(((index,item)=>{let id=$(item).attr("id");id&&id.includes("-tile")&&collapsed_tiles.includes(id)&&$(item).addClass("collapsed")}))})),window.API={get_post:(post_type,postId)=>makeRequestOnPosts("GET",`${post_type}/${postId}`),create_post:(post_type,fields)=>makeRequestOnPosts("POST",`${post_type}`,fields),update_post:(post_type,postId,postData)=>makeRequestOnPosts("POST",`${post_type}/${postId}`,postData),delete_post:(post_type,postId)=>makeRequestOnPosts("DELETE",`${post_type}/${postId}`),post_comment:(post_type,postId,comment,comment_type="comment")=>makeRequestOnPosts("POST",`${post_type}/${postId}/comments`,{comment:comment,comment_type:comment_type}),delete_comment:(post_type,postId,comment_ID)=>makeRequestOnPosts("DELETE",`${post_type}/${postId}/comments/${comment_ID}`),update_comment:(post_type,postId,comment_ID,comment_content,commentType="comment")=>makeRequestOnPosts("POST",`${post_type}/${postId}/comments/${comment_ID}`,{comment:comment_content,comment_type:commentType}),get_comments:(post_type,postId)=>makeRequestOnPosts("GET",`${post_type}/${postId}/comments`),get_activity:(post_type,postId)=>makeRequestOnPosts("GET",`${post_type}/${postId}/activity`),get_single_activity:(post_type,postId,activityId)=>makeRequestOnPosts("GET",`${post_type}/${postId}/activity/${activityId}`),get_shared:(post_type,postId)=>makeRequestOnPosts("GET",`${post_type}/${postId}/shares`),add_shared:(post_type,postId,userId)=>makeRequestOnPosts("POST",`${post_type}/${postId}/shares`,{user_id:userId}),remove_shared:(post_type,postId,userId)=>makeRequestOnPosts("DELETE",`${post_type}/${postId}/shares`,{user_id:userId}),save_field_api:(post_type,postId,postData)=>makeRequestOnPosts("POST",`${post_type}/${postId}`,postData),revert_activity:(post_type,postId,activityId)=>makeRequestOnPosts("GET",`${post_type}/${postId}/revert/${activityId}`),search_users:query=>makeRequest("GET",`users/get_users?s=${query}`),get_filters:()=>makeRequest("GET","users/get_filters"),save_filters:(post_type,filter)=>makeRequest("POST","users/save_filters",{filter:filter,post_type:post_type}),delete_filter:(post_type,id)=>makeRequest("DELETE","users/save_filters",{id:id,post_type:post_type}),get_duplicates_on_post:(post_type,postId,args)=>makeRequestOnPosts("GET",`${post_type}/${postId}/all_duplicates`,args),create_user:user=>makeRequest("POST","users/create",user),transfer_contact:(contactId,siteId)=>makeRequestOnPosts("POST","contacts/transfer",{contact_id:contactId,site_post_id:siteId})},jQuery(document).ajaxComplete(((event,xhr,settings)=>{if(xhr&&xhr.responseJSON&&xhr.responseJSON.ID&&xhr.responseJSON.post_type){let request=settings.data?JSON.parse(settings.data):{};$(document).trigger("dt_record_updated",[xhr.responseJSON,request])}401===window.lodash.get(xhr,"responseJSON.data.status")&&window.location.reload()})).ajaxError(((event,xhr)=>{handleAjaxError(xhr)})),jQuery(document).on("click",".help-button",(function(){jQuery("#help-modal").foundation("open");let section=jQuery(this).data("section");jQuery(".help-section").hide(),jQuery(`#${section}`).show()})),jQuery(document).on("click",".help-button-tile",(function(){jQuery("#help-modal-field").foundation("open");let section=jQuery(this).data("tile");jQuery(".help-section").hide();let tile=window.wpApiShare.tiles[section];if(tile&&window.post_type_fields){tile.label&&$("#help-modal-field-title").html(tile.label),tile.description&&$("#help-modal-field-description").html(tile.description);let html="";window.lodash.forOwn(window.post_type_fields,((field,field_key)=>{if(field.tile===section&&(field.description||window.lodash.isObject(field.default))&&!field.hidden&&(html+=`<h2>${window.lodash.escape(field.name)}</h2>`,html+=`<p>${window.lodash.escape(field.description)}</p>`,window.lodash.isObject(field.default))){let list_html="<ul>";window.lodash.forOwn(field.default,((field_options,field_key)=>{list_html+=`<li><strong>${window.lodash.escape(field_options.label)}</strong> ${window.lodash.escape(field_options.description?"- "+field_options.description:"")}</li>`})),list_html+="</ul>",html+=list_html}})),$("#help-modal-field-body").html(html)}jQuery(`#${section}`).show()})),jQuery(document).on("click",".help-button-field",(function(){jQuery("#help-modal-field").foundation("open");let section=jQuery(this).data("section").replace("-help-text","");if(jQuery(".help-section").hide(),window.post_type_fields&&window.post_type_fields[section]){let field=window.post_type_fields[section];if(field.description&&($("#help-modal-field-title").html(field.name),$("#help-modal-field-description").html(field.description)),window.lodash.isObject(field.default)){let html="<ul>";window.lodash.forOwn(field.default,((field_options,field_key)=>{html+=`<li><strong>${window.lodash.escape(field_options.label)}</strong> ${window.lodash.escape(field_options.description?"- "+field_options.description:"")}</li>`})),html+="</ul>",$("#help-modal-field-body").html(html)}}jQuery(`#${section}`).show()})),window.TYPEAHEADS={typeaheadSource:function(field,url){return{contacts:{display:["name","ID"],template:"<span>{{name}}</span>",ajax:{url:wpApiShare.root+url,data:{s:"{{query}}"},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wpApiShare.nonce)},callback:{done:function(data){return"undefined"!=typeof typeaheadTotals&&(typeaheadTotals.field=data.total),data.posts}}}}}},typeaheadPeopleGroupSource:function(field,url){return{contacts:{template:"<span>{{label}}</span>",ajax:{url:wpApiShare.root+url,data:{s:"{{query}}"},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wpApiShare.nonce)},callback:{done:function(data){return"undefined"!=typeof typeaheadTotals&&(typeaheadTotals.field=data.total),data.posts}}}}}},typeaheadUserSource:function(field,ur){return{users:{display:["name","user"],ajax:{url:wpApiShare.root+"dt/v1/users/get_users",data:{s:"{{query}}"},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wpApiShare.nonce)},callback:{done:function(data){return data.posts||data}}}}}},typeaheadContactsSource:function(){return{contacts:{display:["name","ID"],ajax:{url:wpApiShare.root+"dt-posts/v2/contacts/compact",data:{s:"{{query}}"},beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wpApiShare.nonce)},callback:{done:function(data){return data.posts}}}}}},typeaheadPostsSource:function(post_type,args={}){return{contacts:{display:["name","ID"],ajax:{url:wpApiShare.root+`dt-posts/v2/${post_type}/compact`,data:Object.assign({s:"{{query}}"},args),beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wpApiShare.nonce)},callback:{done:function(data){return data.posts}}}}}},typeaheadHelpText:function(resultCount,query,result){let text="";return text=result.length>0&&query?wpApiShare.translations.showing_x_items_matching.replace("%1$s",`<strong>${window.lodash.escape(result.length)}</strong>`).replace("%2$s",`<strong>${window.lodash.escape(query)}</strong>`):result.length>0?wpApiShare.translations.showing_x_items.replace("%s",`<strong>${window.lodash.escape(result.length)}</strong>`):wpApiShare.translations.no_records_found.replace('"{{query}}"',`<strong>${window.lodash.escape(query)}</strong>`),text},contactListRowTemplate:function(query,item){let img=item.user?`<img src="${wpApiShare.template_dir}/dt-assets/images/profile.svg">`:"";return`<span dir="auto" ${"closed"===item.status?'style="color:gray"':""}>\n      <span class="typeahead-user-row" style="width:20px">${img}</span>\n      ${window.lodash.escape(item.name)}\n      <span dir="auto">(#${window.lodash.escape(item.ID)})</span>\n    </span>`},share(post_type,id,v2){return $.typeahead({input:".js-typeahead-share",minLength:0,maxItem:0,accent:!0,searchOnFocus:!0,source:this.typeaheadSource("share","dt/v1/users/get_users"),display:"name",templateValue:"{{name}}",dynamic:!0,multiselect:{matchOn:["ID"],data:function(){var deferred=$.Deferred();return window.API.get_shared(post_type,id).then((sharedResult=>deferred.resolve(sharedResult.map((g=>({ID:g.user_id,name:g.display_name}))))))},callback:{onCancel:function(node,item){$("#share-result-container").html(""),window.API.remove_shared(post_type,id,item.ID).catch((err=>{Typeahead[".js-typeahead-share"].addMultiselectItemLayout({ID:item.ID,name:item.name}),$("#share-result-container").html(window.lodash.get(err,"responseJSON.message"))}))}}},callback:{onClick:function(node,a,item,event){window.API.add_shared(post_type,id,item.ID)},onResult:function(node,query,result,resultCount){if(query){let text=window.TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$("#share-result-container").html(text)}},onHideLayout:function(){$("#share-result-container").html("")}}})},defaultContactTypeahead:function(){return{minLength:0,accent:!0,searchOnFocus:!0,maxItem:20,template:this.contactListRowTemplate,source:this.typeaheadContactsSource(),display:"name",templateValue:"{{name}}",dynamic:!0}}},window.SHAREDFUNCTIONS={getCookie(cname){let name=cname+"=",ca=decodeURIComponent(document.cookie).split(";");for(let i=0;i<ca.length;i++){let c=ca[i];for(;" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""},get_json_cookie(cname,default_val=[]){let cookie=this.getCookie(cname);try{default_val=JSON.parse(cookie)}catch(e){}return default_val},save_json_cookie(cname,json,path=""){path&&(path=(path=window.location.pathname.split(path)[0]+path).replace(/^\/?([^\/]+(?:\/[^\/]+)*)\/?$/,"/$1")),document.cookie=`${cname}=${JSON.stringify(json)};path=${path}`},formatDate(date,with_time=!1){let langcode=document.querySelector("html").getAttribute("lang")?document.querySelector("html").getAttribute("lang").replace("_","-"):"en";"fa-IR"===langcode&&(langcode=`${langcode}-u-ca-gregory`);const options={year:"numeric",month:"long",day:"numeric"};with_time?(options.hour="numeric",options.minute="numeric"):options.timeZone="UTC";return new Intl.DateTimeFormat(langcode,options).format(1e3*date)},convertArabicToEnglishNumbers:string=>string.replace(/[\u0660-\u0669]/g,(function(c){return c.charCodeAt(0)-1632})).replace(/[\u06f0-\u06f9]/g,(function(c){return c.charCodeAt(0)-1776})),get_url_param(name){let results=new RegExp("[?&]"+name+"=([^&#]*)").exec(window.location.search);return null!==results&&(results[1]||0)}},window.METRICS={setupDatePicker:function(endpoint_url,callback,startDate,endDate){$(".date_range_picker").daterangepicker({showDropdowns:!0,ranges:{"All time":[moment(0),moment().endOf("year")],[moment().format("MMMM YYYY")]:[moment().startOf("month"),moment().endOf("month")],[moment().subtract(1,"month").format("MMMM YYYY")]:[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],[moment().format("YYYY")]:[moment().startOf("year"),moment().endOf("year")],[moment().subtract(1,"year").format("YYYY")]:[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year")],[moment().subtract(2,"year").format("YYYY")]:[moment().subtract(2,"year").startOf("year"),moment().subtract(2,"year").endOf("year")]},linkedCalendars:!1,locale:{format:"YYYY-MM-DD"},startDate:startDate||moment(0),endDate:endDate||moment().endOf("year").format("YYYY-MM-DD")},(function(start,end,label){$(".loading-spinner").addClass("active"),jQuery.ajax({type:"GET",contentType:"application/json; charset=utf-8",dataType:"json",url:`${endpoint_url}?start=${start.format("YYYY-MM-DD")}&end=${end.format("YYYY-MM-DD")}`,beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",wpApiShare.nonce)}}).done((function(data){$(".loading-spinner").removeClass("active"),"Custom Range"===label&&(label=start.format("MMMM D, YYYY")+" - "+end.format("MMMM D, YYYY")),callback(data,label,start,end)})).fail((function(err){console.log("error"),console.log(err)}))}))}},window.fiveMinuteTimer=setInterval((function(){get_new_notification_count().fail((function(x){window.location.reload()}))}),3e5);
//# sourceMappingURL=shared-functions.min.js.map
