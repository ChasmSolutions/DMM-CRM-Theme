"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{return Promise.resolve(value).then(function(value){step("next",value);},function(err){step("throw",err);});}}return step("next");});};}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}(function($,list_settings,Foundation){var selected_filters=$("#selected-filters");var new_filter_labels=[];var custom_filters=[];var filter_to_save="";var filter_to_delete="";var filterToEdit="";var filter_accordions=$('#list-filter-tabs');var currentFilters=$("#current-filters");var cookie=window.SHAREDFUNCTIONS.getCookie("last_view");var cached_filter=void 0;var get_records_promise=null;var loading_spinner=$("#list-loading-spinner");var old_filters=JSON.stringify(list_settings.filters);var table_header_row=$('.js-list thead .sortable th');var fields_to_show_in_table=window.SHAREDFUNCTIONS.get_json_cookie('fields_to_show_in_table',[]);var fields_to_search=window.SHAREDFUNCTIONS.get_json_cookie('fields_to_search',[]);var current_user_id=wpApiNotifications.current_user_id;var mobile_breakpoint=1024;var items=[];try{cached_filter=JSON.parse(cookie);}catch(e){cached_filter={};}var current_filter=cached_filter&&!window.lodash.isEmpty(cached_filter)?cached_filter:{query:{}//set up main filters
};setup_filters();var check_first_filter=function check_first_filter(){$('#list-filter-tabs .accordion-item a')[0].click();$($('.js-list-view')[0]).prop('checked',true);};//set up custom cached filter
if(cached_filter&&!window.lodash.isEmpty(cached_filter)&&cached_filter.type==="custom_filter"){cached_filter.query.offset=0;add_custom_filter(cached_filter.name,"default",cached_filter.query,cached_filter.labels,false);}else{//check select filter
if(current_filter.ID){//open the filter tabs
$("#list-filter-tabs [data-id='"+window.lodash.escape(current_filter.tab)+"'] a").click();var filter_element=$("input[name=view][data-id=\""+window.lodash.escape(current_filter.ID)+"\"].js-list-view");if(filter_element.length){filter_element.prop('checked',true);}else{check_first_filter();}}else{check_first_filter();}}//determine list columns
if(window.lodash.isEmpty(fields_to_show_in_table)){window.lodash.forOwn(list_settings.post_type_settings.fields,function(field_settings,field_key){if(window.lodash.get(field_settings,'show_in_table')===true||window.lodash.get(field_settings,'show_in_table')>0){fields_to_show_in_table.push(field_key);}});fields_to_show_in_table.sort(function(a,b){var a_order=list_settings.post_type_settings.fields[a].show_in_table?list_settings.post_type_settings.fields[a].show_in_table===true?50:list_settings.post_type_settings.fields[a].show_in_table:200;var b_order=list_settings.post_type_settings.fields[b].show_in_table?list_settings.post_type_settings.fields[b].show_in_table===true?50:list_settings.post_type_settings.fields[b].show_in_table:200;return a_order>b_order?1:-1;});}// get records on load and when a filter is clicked
get_records_for_current_filter();$(document).on('change','.js-list-view',function(){get_records_for_current_filter();});//load record for the first filter when a tile is clicked
$(document).on('click','.accordion-title',function(){var selected_filter=$(".js-list-view:checked").data('id');var tab=$(this).data('id');if(selected_filter){$(".accordion-item[data-id='"+tab+"'] .js-list-view").first().prop('checked',true);get_records_for_current_filter();}});function get_records_for_current_filter(){var checked=$(".js-list-view:checked");var current_view=checked.val();var filter_id=checked.data("id")||current_view||"";var sort=current_filter.query.sort||null;if(current_view==="custom_filter"){var filterId=checked.data("id");current_filter=window.lodash.find(custom_filters,{ID:filterId});current_filter.type=current_view;}else{current_filter=window.lodash.find(list_settings.filters.filters,{ID:filter_id})||window.lodash.find(list_settings.filters.filters,{ID:filter_id.toString()})||current_filter;current_filter.type='default';current_filter.labels=current_filter.labels||[{id:filter_id,name:current_filter.name}];}sort=sort||current_filter.query.sort;current_filter.query.sort=typeof sort==="string"?sort:"name";get_records();}function setup_filters(){if(!list_settings.filters.tabs){return;}var selected_tab=$('.accordion-item.is-active').data('id');var selected_filter=$(".js-list-view:checked").data('id');var html="";list_settings.filters.tabs.forEach(function(tab){html+="\n      <li class=\"accordion-item\" data-accordion-item data-id=\""+window.lodash.escape(tab.key)+"\">\n        <a href=\"#\" class=\"accordion-title\" data-id=\""+window.lodash.escape(tab.key)+"\">\n          "+window.lodash.escape(tab.label)+"\n          <span class=\"tab-count-span\" data-tab=\""+window.lodash.escape(tab.key)+"\">\n              "+(tab.count||tab.count>=0?"("+window.lodash.escape(tab.count)+")":"")+"\n          </span>\n        </a>\n        <div class=\"accordion-content\" data-tab-content>\n          <div class=\"list-views\">\n            "+list_settings.filters.filters.map(function(filter){if(filter.tab===tab.key&&filter.tab!=='custom'){var indent=filter.subfilter&&Number.isInteger(filter.subfilter)?15*filter.subfilter:15;return"\n                  <label class=\"list-view\" style=\""+(filter.subfilter?"margin-left:"+indent+"px":'')+"\">\n                    <input type=\"radio\" name=\"view\" value=\""+window.lodash.escape(filter.ID)+"\" data-id=\""+window.lodash.escape(filter.ID)+"\" class=\"js-list-view\" autocomplete=\"off\">\n                    <span id=\"total_filter_label\">"+window.lodash.escape(filter.name)+"</span>\n                    <span class=\"list-view__count js-list-view-count\" data-value=\""+window.lodash.escape(filter.ID)+"\">"+window.lodash.escape(filter.count)+"</span>\n                  </label>\n                  ";}}).join('')+"\n          </div>\n        </div>\n      </li>\n      ";});filter_accordions.html(html);var saved_filters_list=$("#list-filter-tabs [data-id='custom'] .list-views");saved_filters_list.empty();if(list_settings.filters.filters.filter(function(t){return t.tab==='custom';}).length===0){saved_filters_list.html("<span>"+window.lodash.escape(list_settings.translations.empty_custom_filters)+"</span>");}list_settings.filters.filters.filter(function(t){return t.tab==='custom';}).forEach(function(filter){if(filter&&filter.visible===''){return;}var delete_filter=$("<span style=\"float:right\" data-filter=\""+window.lodash.escape(filter.ID)+"\">\n        <img style=\"padding: 0 4px\" src=\""+window.wpApiShare.template_dir+"/dt-assets/images/trash.svg\">\n      </span>");delete_filter.on("click",function(){$(".delete-filter-name").html(filter.name);$('#delete-filter-modal').foundation('open');filter_to_delete=filter.ID;});var edit_filter=$("<span style=\"float:right\" data-filter=\""+window.lodash.escape(filter.ID)+"\">\n          <img style=\"padding: 0 4px\" src=\""+window.wpApiShare.template_dir+"/dt-assets/images/edit.svg\">\n      </span>");edit_filter.on("click",function(){edit_saved_filter(filter);filterToEdit=filter.ID;});var filterName="<span class=\"filter-list-name\" data-filter=\""+window.lodash.escape(filter.ID)+"\">"+window.lodash.escape(filter.name)+"</span>";var radio=$("<input name='view' class='js-list-view' autocomplete='off' data-id=\""+window.lodash.escape(filter.ID)+"\" >").attr("type","radio").val("saved-filters").on("change",function(){});saved_filters_list.append($("<div>").append($("<label>").css("cursor","pointer").addClass("js-filter-checkbox-label").data("filter-value",status).append(radio).append(filterName).append(delete_filter).append(edit_filter)));});new Foundation.Accordion(filter_accordions,{slideSpeed:100,allowAllClosed:true});if(selected_tab){$("#list-filter-tabs [data-id='"+window.lodash.escape(selected_tab)+"'] a").click();}if(selected_filter){$("[data-id=\""+window.lodash.escape(selected_filter)+"\"].js-list-view").prop('checked',true);}}var getFilterCountsPromise=null;var get_filter_counts=function get_filter_counts(){if(getFilterCountsPromise&&window.lodash.get(getFilterCountsPromise,"readyState")!==4){getFilterCountsPromise.abort();}getFilterCountsPromise=$.ajax({url:window.wpApiShare.root+"dt/v1/users/get_filters?post_type="+list_settings.post_type+"&force_refresh=1",beforeSend:function beforeSend(xhr){xhr.setRequestHeader('X-WP-Nonce',window.wpApiShare.nonce);}});getFilterCountsPromise.then(function(filters){if(old_filters!==JSON.stringify(filters)){list_settings.filters=filters;setup_filters();}}).catch(function(err){if(window.lodash.get(err,"statusText")!=="abort"){console.error(err);}});};get_filter_counts();function setup_current_filter_labels(){var html="";var filter=current_filter;if(filter&&filter.labels){filter.labels.forEach(function(label){html+="<span class=\"current-filter "+window.lodash.escape(label.field)+"\">"+window.lodash.escape(label.name)+"</span>";});}else{var query=filter.query;window.lodash.forOwn(query,function(query_key){if(Array.isArray(query[query_key])){query[query_key].forEach(function(q){html+="<span class=\"current-filter "+window.lodash.escape(query_key)+"\">"+window.lodash.escape(q)+"</span>";});}else{html+="<span class=\"current-filter search\">"+window.lodash.escape(query[query_key])+"</span>";}});}if(filter.query.sort){var sortLabel=filter.query.sort;if(sortLabel.includes('last_modified')){sortLabel=list_settings.translations.date_modified;}else if(sortLabel.includes('post_date')){sortLabel=list_settings.translations.creation_date;}else{sortLabel=window.lodash.get(list_settings,"post_type_settings.fields["+filter.query.sort+"].name",sortLabel);}html+="<span class=\"current-filter\" data-id=\"sort\">\n          "+window.lodash.escape(list_settings.translations.sorting_by)+": "+window.lodash.escape(sortLabel)+"\n      </span>";}currentFilters.html(html);}var sort_field=window.lodash.get(current_filter,"query.sort","name");//reset sorting in table header
table_header_row.removeClass("sorting_asc");table_header_row.removeClass("sorting_desc");var header_cell=$(".js-list thead .sortable th[data-id=\""+window.lodash.escape(sort_field.replace("-",""))+"\"]");header_cell.addClass("sorting_"+(sort_field.startsWith('-')?'desc':'asc'));table_header_row.data("sort",'');header_cell.data("sort",'asc');$('.js-sort-by').on("click",function(){table_header_row.removeClass("sorting_asc");table_header_row.removeClass("sorting_desc");var dir=$(this).data('order');var field=$(this).data('field');get_records(0,(dir==="asc"?"":'-')+field);});//sort the table by clicking the header
$('.js-list th').on("click",function(){//check is this is the bulk_edit_master checkbox
if(this.id=="bulk_edit_master"){return;}var id=$(this).data('id');var sort=$(this).data('sort');table_header_row.removeClass("sorting_asc");table_header_row.removeClass("sorting_desc");table_header_row.data("sort",'');if(!sort||sort==='desc'){$(this).data('sort','asc');$(this).addClass("sorting_asc");$(this).removeClass("sorting_desc");}else{$(this).data('sort','desc');$(this).removeClass("sorting_asc");$(this).addClass("sorting_desc");id="-"+id;}get_records(0,id);});$('#choose_fields_to_show_in_table').on('click',function(){$('#list_column_picker').toggle();});$('#save_column_choices').on('click',function(){var new_selected=[];$('#list_column_picker input:checked').each(function(index,elem){new_selected.push($(elem).val());});fields_to_show_in_table=window.lodash.intersection(fields_to_show_in_table,new_selected);// remove unchecked
fields_to_show_in_table=window.lodash.uniq(window.lodash.union(fields_to_show_in_table,new_selected));window.SHAREDFUNCTIONS.save_json_cookie('fields_to_show_in_table',fields_to_show_in_table,list_settings.post_type);window.location.reload();});$('#reset_column_choices').on('click',function(){fields_to_show_in_table=[];window.SHAREDFUNCTIONS.save_json_cookie('fields_to_show_in_table',fields_to_show_in_table,list_settings.post_type);window.location.reload();});$('#records-table').dragableColumns({drag:true,dragClass:'drag',overClass:'over',movedContainerSelector:'.dnd-moved',onDragEnd:function onDragEnd(){fields_to_show_in_table=[];$('.table-headers th').each(function(i,e){var field=$(e).data('id');if(field){fields_to_show_in_table.push(field);}});window.SHAREDFUNCTIONS.save_json_cookie('fields_to_show_in_table',fields_to_show_in_table,list_settings.post_type);}}).on('click','tbody tr',function(event){//open the record if the row is clicked. Give priority to normal browser behavior with links.
if(!event.target.href){window.location=$(this).data('link');}});var build_table=function build_table(records){var table_rows="";var mobile=$(window).width()<mobile_breakpoint;records.forEach(function(record,index){var row_fields_html='';fields_to_show_in_table.forEach(function(field_key){var values_html='';var values=[];if(field_key==="name"){if(mobile){return;}values_html="<a href=\""+window.lodash.escape(record.permalink)+"\" title=\""+window.lodash.escape(record.post_title)+"\">"+window.lodash.escape(record.post_title)+"</a>";}else if(list_settings.post_type_settings.fields[field_key]){var _field_settings=list_settings.post_type_settings.fields[field_key];var field_value=window.lodash.get(record,field_key,false);if(field_value){if(['text','number'].includes(_field_settings.type)){values=[window.lodash.escape(field_value)];}else if(_field_settings.type==='date'){values=[window.lodash.escape(window.SHAREDFUNCTIONS.formatDate(field_value.timestamp))];}else if(_field_settings.type==='user_select'){values=[window.lodash.escape(field_value.display)];}else if(_field_settings.type==='key_select'){values=[window.lodash.escape(field_value.label)];}else if(_field_settings.type==='multi_select'){values=field_value.map(function(v){return""+window.lodash.escape(window.lodash.get(_field_settings,"default["+v+"].label",v));});}else if(_field_settings.type==="location"){values=field_value.map(function(v){return""+window.lodash.escape(v.label);});}else if(_field_settings.type==="communication_channel"){values=field_value.map(function(v){return""+window.lodash.escape(v.value);});}else if(_field_settings.type==="connection"){values=field_value.map(function(v){return""+window.lodash.escape(v.post_title);});}else if(_field_settings.type==="boolean"){values=['&check;'];}}}else{return;}values_html+=values.map(function(v){return"<li>"+v+"</li>";}).join('');if($(window).width()<mobile_breakpoint){row_fields_html+="\n            <td>\n              <div class=\"mobile-list-field-name\">\n                <ul>\n                "+window.lodash.escape(window.lodash.get(list_settings,"post_type_settings.fields["+field_key+"].name",field_key))+"\n                </ul>\n              </div>\n              <div class=\"mobile-list-field-value\">\n                <ul style=\"line-height:20px\" >\n                  "+values.join(', ')+"\n                </ul>\n              </div>\n\n            </td>\n          ";}else{row_fields_html+="\n            <td title=\""+values.join(', ')+"\">\n              <ul>\n                "+values_html+"\n              </ul>\n            </td>\n          ";}});if(mobile){table_rows+="<tr data-link=\""+window.lodash.escape(record.permalink)+"\">\n          <td class=\"bulk_edit_checkbox\">\n              <input class=\"bulk_edit_checkbox\" type=\"checkbox\" name=\"bulk_edit_id\" value=\""+record.ID+"\">\n          </td>\n          <td>\n              <div class=\"mobile-list-field-name\">\n                "+(index+1)+".\n              </div>\n              <div class=\"mobile-list-field-value\">\n                  <a href=\""+window.lodash.escape(record.permalink)+"\">"+window.lodash.escape(record.post_title)+"</a>\n              </div>\n          </td>\n          "+row_fields_html+"\n        ";}else{table_rows+="<tr class=\"dnd-moved\" data-link=\""+window.lodash.escape(record.permalink)+"\">\n          <td class=\"bulk_edit_checkbox\" ><input type=\"checkbox\" name=\"bulk_edit_id\" value=\""+record.ID+"\"></td>\n          <td style=\"white-space: nowrap\" >"+(index+1)+".</td>\n          "+row_fields_html+"\n        ";}});if(records.length===0){table_rows="<tr><td colspan=\"10\">"+window.lodash.escape(list_settings.translations.empty_list)+"</td></tr>";}var table_html="\n      "+table_rows+"\n    ";$('#table-content').html(table_html);bulk_edit_checkbox_event();};function get_records(){var offset=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var sort=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;loading_spinner.addClass("active");var query=current_filter.query;if(offset){query["offset"]=offset;}if(sort){query.sort=sort;query.offset=0;}window.SHAREDFUNCTIONS.save_json_cookie("last_view",current_filter,list_settings.post_type);if(get_records_promise&&window.lodash.get(get_records_promise,"readyState")!==4){get_records_promise.abort();}query.fields_to_return=fields_to_show_in_table;get_records_promise=window.makeRequestOnPosts('GET',""+list_settings.post_type,JSON.parse(JSON.stringify(query)));get_records_promise.then(function(response){if(offset){items=window.lodash.unionBy(items,response.posts||[],"ID");}else{items=response.posts||[];}window.records_list=response;// adds global access to current list for plugins
$('#bulk_edit_master_checkbox').prop("checked",false);//unchecks the bulk edit master checkbox when the list reloads.
$('#load-more').toggle(items.length!==parseInt(response.total));var result_text=list_settings.translations.txt_info.replace("_START_",items.length).replace("_TOTAL_",response.total);$('.filter-result-text').html(result_text);build_table(items);setup_current_filter_labels();loading_spinner.removeClass("active");}).catch(function(err){loading_spinner.removeClass("active");if(window.lodash.get(err,"statusText")!=="abort"){console.error(err);}});}$('#load-more').on('click',function(){get_records(items.length);});/**
   * Modal options
   *///add the new filter in the filters list
function add_custom_filter(name,type,query,labels){var load_records=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;query=query||current_filter.query;var ID=new Date().getTime()/1000;current_filter={ID:ID,type:type,name:window.lodash.escape(name),query:JSON.parse(JSON.stringify(query)),labels:labels};custom_filters.push(JSON.parse(JSON.stringify(current_filter)));var save_filter=$("<a style=\"float:right\" data-filter=\""+window.lodash.escape(ID.toString())+"\">\n        "+window.lodash.escape(list_settings.translations.save)+"\n    </a>").on("click",function(){$("#filter-name").val(name);$('#save-filter-modal').foundation('open');filter_to_save=ID;});var filterRow=$("<label class='list-view "+window.lodash.escape(ID.toString())+"'>").append("\n      <input type=\"radio\" name=\"view\" value=\"custom_filter\" data-id=\""+window.lodash.escape(ID.toString())+"\" class=\"js-list-view\" checked autocomplete=\"off\">\n        "+window.lodash.escape(name)+"\n    ").append(save_filter);$(".custom-filters").append(filterRow);if(load_records){get_records_for_current_filter();}}var get_custom_filter_search_query=function get_custom_filter_search_query(){var search_query=[];var fields_filtered=window.lodash.uniq(new_filter_labels.map(function(f){return f.field;}));fields_filtered.forEach(function(field){var type=window.lodash.get(list_settings,"post_type_settings.fields."+field+".type");if(type==="connection"||type==="user_select"){search_query.push(_defineProperty({},field,window.lodash.map(window.lodash.get(Typeahead[".js-typeahead-"+field],"items"),"ID")));}if(type==="multi_select"){search_query.push(_defineProperty({},field,window.lodash.map(window.lodash.get(Typeahead[".js-typeahead-"+field],"items"),"key")));}if(type==="location"){search_query.push(_defineProperty({},field,window.lodash.map(window.lodash.get(Typeahead[".js-typeahead-"+field],"items"),'ID')));}else if(type==="date"){var date={};var start=$(".dt_date_picker[data-field=\""+field+"\"][data-delimit=\"start\"]").val();if(start){date.start=start;}var end=$(".dt_date_picker[data-field=\""+field+"\"][data-delimit=\"end\"]").val();if(end){date.end=end;}search_query.push(_defineProperty({},field,date));}else{var options=[];$("#"+field+"-options input:checked").each(function(){options.push($(this).val());});if(options.length){search_query.push(_defineProperty({},field,options));}}});search_query={fields:search_query};if(list_settings.post_type==="contacts"){if($("#combine_subassigned").is(":checked")){var assigned_to=search_query.fields.filter(function(a){return a.assigned_to;});var subassigned=search_query.fields.filter(function(a){return a.subassigned;});search_query.fields=search_query.fields.filter(function(a){return!a.assigned_to&&!a.subassigned;});search_query.fields.push([assigned_to[0],subassigned[0]]);search_query.combine=["subassigned"];// to select checkbox in filter modal
}}return search_query;};$("#confirm-filter-records").on("click",function(){var search_query=get_custom_filter_search_query();var filterName=window.lodash.escape($('#new-filter-name').val());add_custom_filter(filterName||"Custom Filter","custom-filter",search_query,new_filter_labels);});var load_multi_select_typeaheads=function(){var _ref=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee(){var _loop,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,input,_ret;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_loop=function _loop(input){var field=$(input).data('field');var typeahead_name=".js-typeahead-"+field;if(window.Typeahead[typeahead_name]){return{v:void 0};}var source_data={data:[]};var field_options=window.lodash.get(list_settings,"post_type_settings.fields."+field+".default",{});if(Object.keys(field_options).length>0){window.lodash.forOwn(field_options,function(val,key){if(!val.deleted){source_data.data.push({key:key,name:key,value:val.label||key});}});}else{source_data=_defineProperty({},field,{display:["value"],ajax:{url:window.wpApiShare.root+("dt-posts/v2/"+list_settings.post_type+"/multi-select-values"),data:{s:"{{query}}",field:field},beforeSend:function beforeSend(xhr){xhr.setRequestHeader('X-WP-Nonce',window.wpApiShare.nonce);},callback:{done:function done(data){return(data||[]).map(function(tag){var label=window.lodash.get(field_options,tag+".label",tag);return{value:label,key:tag};});}}}});}$.typeahead({input:".js-typeahead-"+field,minLength:0,maxItem:20,searchOnFocus:true,template:function template(query,item){return"<span>"+window.lodash.escape(item.value)+"</span>";},source:source_data,display:"value",templateValue:"{{value}}",dynamic:true,multiselect:{matchOn:["key"],data:[],callback:{onCancel:function onCancel(node,item){$(".current-filter[data-id=\""+item.key+"\"]."+field).remove();window.lodash.pullAllBy(new_filter_labels,[{id:item.key}],"id");}}},callback:{onClick:function onClick(node,a,item){var name=window.lodash.get(list_settings,"post_type_settings.fields."+field+".name",field);selected_filters.append("<span class=\"current-filter "+window.lodash.escape(field)+"\" data-id=\""+window.lodash.escape(item.key)+"\">"+window.lodash.escape(name)+":"+window.lodash.escape(item.value)+"</span>");new_filter_labels.push({id:item.key,name:name+": "+item.value,field:field});},onResult:function onResult(node,query,result,resultCount){var text=TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$("#"+field+"-result-container").html(text);},onHideLayout:function onHideLayout(){$("#"+field+"-result-container").html("");}}});};_iteratorNormalCompletion=true;_didIteratorError=false;_iteratorError=undefined;_context.prev=4;_iterator=$(".multi_select .typeahead__query input")[Symbol.iterator]();case 6:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context.next=14;break;}input=_step.value;_ret=_loop(input);if(!((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")){_context.next=11;break;}return _context.abrupt("return",_ret.v);case 11:_iteratorNormalCompletion=true;_context.next=6;break;case 14:_context.next=20;break;case 16:_context.prev=16;_context.t0=_context["catch"](4);_didIteratorError=true;_iteratorError=_context.t0;case 20:_context.prev=20;_context.prev=21;if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}case 23:_context.prev=23;if(!_didIteratorError){_context.next=26;break;}throw _iteratorError;case 26:return _context.finish(23);case 27:return _context.finish(20);case 28:case"end":return _context.stop();}}},_callee,this,[[4,16,20,28],[21,,23,27]]);}));function load_multi_select_typeaheads(){return _ref.apply(this,arguments);}return load_multi_select_typeaheads;}();var load_post_type_typeaheads=function load_post_type_typeaheads(){$(".typeahead__query [data-type='connection']").each(function(key,el){var field_key=$(el).data('field');var post_type=window.lodash.get(list_settings,"post_type_settings.fields."+field_key+".post_type",field_key);if(!window.Typeahead[".js-typeahead-"+field_key]){$.typeahead({input:".js-typeahead-"+field_key,minLength:0,accent:true,searchOnFocus:true,maxItem:20,template:function template(query,item){return"<span dir=\"auto\">"+window.lodash.escape(item.name)+" (#"+window.lodash.escape(item.ID)+")</span>";},source:TYPEAHEADS.typeaheadPostsSource(post_type),display:"name",templateValue:"{{name}}",dynamic:true,multiselect:{matchOn:["ID"],data:[],callback:{onCancel:function onCancel(node,item){$(".current-filter[data-id=\""+item.ID+"\"]."+field_key).remove();window.lodash.pullAllBy(new_filter_labels,[{id:item.ID}],"id");}}},callback:{onResult:function onResult(node,query,result,resultCount){var text=TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$("#"+field_key+"-result-container").html(text);},onHideLayout:function onHideLayout(){$("#"+field_key+"-result-container").html("");},onClick:function onClick(node,a,item){new_filter_labels.push({id:item.ID,name:item.name,field:field_key});selected_filters.append("<span class=\"current-filter "+field_key+"\" data-id=\""+window.lodash.escape(item.ID)+"\">"+window.lodash.escape(item.name)+"</span>");}}});}});};var load_user_select_typeaheads=function load_user_select_typeaheads(){$(".typeahead__query [data-type='user_select']").each(function(key,el){var field_key=$(el).data('field');if(!window.Typeahead[".js-typeahead-"+field_key]){$.typeahead({input:".js-typeahead-"+field_key,minLength:0,accent:true,searchOnFocus:true,maxItem:20,template:function template(query,item){return"<span dir=\"auto\">"+window.lodash.escape(item.name)+" (#"+window.lodash.escape(item.ID)+")</span>";},source:TYPEAHEADS.typeaheadUserSource(),display:"name",templateValue:"{{name}}",dynamic:true,multiselect:{matchOn:["ID"],data:[],callback:{onCancel:function onCancel(node,item){$(".current-filter[data-id=\""+item.ID+"\"]."+field_key).remove();window.lodash.pullAllBy(new_filter_labels,[{id:item.ID}],"id");}}},callback:{onResult:function onResult(node,query,result,resultCount){var text=TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$("#"+field_key+"-result-container").html(text);},onHideLayout:function onHideLayout(){$("#"+field_key+"-result-container").html("");},onClick:function onClick(node,a,item){new_filter_labels.push({id:item.ID,name:item.name,field:field_key});selected_filters.append("<span class=\"current-filter "+field_key+"\" data-id=\""+window.lodash.escape(item.ID)+"\">"+window.lodash.escape(item.name)+"</span>");}}});}});};/**
   * Location
   */$('#mapbox-clear-autocomplete').click("input",function(){delete window.location_data;});var loadLocationTypeahead=function loadLocationTypeahead(){if(!window.Typeahead['.js-typeahead-location_grid']){$.typeahead({input:'.js-typeahead-location_grid',minLength:0,accent:true,searchOnFocus:true,maxItem:20,dropdownFilter:[{key:'group',value:'used',template:window.lodash.escape(window.wpApiShare.translations.used_locations),all:window.lodash.escape(window.wpApiShare.translations.all_locations)}],source:{used:{display:"name",ajax:{url:window.wpApiShare.root+'dt/v1/mapping_module/search_location_grid_by_name',data:{s:"{{query}}",filter:function filter(){return window.lodash.get(window.Typeahead['.js-typeahead-location_grid'].filters.dropdown,'value','all');}},beforeSend:function beforeSend(xhr){xhr.setRequestHeader('X-WP-Nonce',window.wpApiShare.nonce);},callback:{done:function done(data){if(typeof typeaheadTotals!=="undefined"){typeaheadTotals.field=data.total;}return data.location_grid;}}}}},display:"name",templateValue:"{{name}}",dynamic:true,multiselect:{matchOn:["ID"],data:[],callback:{onCancel:function onCancel(node,item){$(".current-filter[data-id=\""+item.ID+"\"].location_grid").remove();window.lodash.pullAllBy(new_filter_labels,[{id:item.ID}],"id");}}},callback:{onResult:function onResult(node,query,result,resultCount){var text=TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$('#location_grid-result-container').html(text);},onReady:function onReady(){this.filters.dropdown={key:"group",value:"used",template:"Used Locations"};this.container.removeClass("filter").find("."+this.options.selector.filterButton).html("Used Locations");},onHideLayout:function onHideLayout(){$('#location_grid-result-container').html("");},onClick:function onClick(node,a,item){var name=window.lodash.get(list_settings,"post_type_settings.fields.location_grid.name",'location_grid');new_filter_labels.push({id:item.ID,name:name+": "+item.name,field:"location_grid"});selected_filters.append("<span class=\"current-filter location_grid\" data-id=\""+window.lodash.escape(item.ID)+"\">"+window.lodash.escape(name)+":"+window.lodash.escape(item.name)+"</span>");}}});}};/*
   * Setup filter box
   */var typeaheads_loaded=null;$('#filter-modal').on("open.zf.reveal",function(){new_filter_labels=[];loadLocationTypeahead();load_post_type_typeaheads();load_user_select_typeaheads();typeaheads_loaded=load_multi_select_typeaheads().catch(function(err){console.error(err);});$('#new-filter-name').val('');$("#filter-modal input.dt_date_picker").each(function(){$(this).val('');});$("#filter-modal input:checked").each(function(){$(this).prop('checked',false);});selected_filters.empty();$(".typeahead__query input").each(function(){var typeahead=Typeahead['.'+$(this).attr("class").split(/\s+/)[0]];if(typeahead&&typeahead.items){for(var i=0;i<typeahead.items.length;i){typeahead.cancelMultiselectItem(0);}typeahead.node.trigger('propertychange.typeahead');}});$('#confirm-filter-records').show();$('#save-filter-edits').hide();});var edit_saved_filter=function edit_saved_filter(filter){$('#filter-modal').foundation('open');typeaheads_loaded.then(function(){new_filter_labels=filter.labels;var connectionTypeKeys=list_settings.post_type_settings.connection_types;connectionTypeKeys.push("location_grid");new_filter_labels.forEach(function(label){selected_filters.append("<span class=\"current-filter "+window.lodash.escape(label.field)+"\" data-id=\""+window.lodash.escape(label.id)+"\">"+window.lodash.escape(label.name)+"</span>");var type=window.lodash.get(list_settings,"post_type_settings.fields."+label.field+".type");if(type==="key_select"||type==="boolean"){$("#filter-modal #"+label.field+"-options input[value=\""+label.id+"\"]").prop('checked',true);}else if(type==="date"){$("#filter-modal #"+label.field+"-options #"+label.id).datepicker('setDate',label.date);}else if(connectionTypeKeys.includes(label.field)){Typeahead[".js-typeahead-"+label.field].addMultiselectItemLayout({ID:label.id,name:label.name});}else if(type==="multi_select"){Typeahead[".js-typeahead-"+label.field].addMultiselectItemLayout({key:label.id,value:label.name});}else if(type==="user_select"){Typeahead[".js-typeahead-"+label.field].addMultiselectItemLayout({name:label.name,ID:label.id});}});(filter.query.combine||[]).forEach(function(c){$("#combine_"+c).prop('checked',true);});$('#new-filter-name').val(filter.name);$('#confirm-filter-records').hide();$('#save-filter-edits').data("filter-id",filter.ID).show();});};$('#save-filter-edits').on('click',function(){var search_query=get_custom_filter_search_query();var filter_id=$('#save-filter-edits').data("filter-id");var filter=window.lodash.find(list_settings.filters.filters,{ID:filter_id});filter.name=$('#new-filter-name').val();$(".filter-list-name[data-filter=\""+filter_id+"\"]").text(filter.name);filter.query=search_query;filter.labels=new_filter_labels;API.save_filters(list_settings.post_type,filter);get_records_for_current_filter();});$('#filter-tabs').on('change.zf.tabs',function(a,b){var field=$(b).data("field");$(".tabs-panel").removeClass('is-active');$("#"+field+".tabs-panel").addClass('is-active');if(field&&Typeahead[".js-typeahead-"+field]){Typeahead[".js-typeahead-"+field].adjustInputSize();}});//watch all other checkboxes
$('#filter-modal .key_select_options input').on("change",function(){var field_key=$(this).data('field');var option_id=$(this).val();if($(this).is(":checked")){var _field_options=window.lodash.get(list_settings,"post_type_settings.fields."+field_key+".default");var option_name=_field_options[option_id]["label"];var name=window.lodash.get(list_settings,"post_type_settings.fields."+field_key+".name",field_key);new_filter_labels.push({id:$(this).val(),name:name+": "+option_name,field:field_key});selected_filters.append("<span class=\"current-filter "+window.lodash.escape(field_key)+"\" data-id=\""+window.lodash.escape(option_id)+"\">"+window.lodash.escape(name)+":"+window.lodash.escape(option_name)+"</span>");}else{$(".current-filter[data-id=\""+$(this).val()+"\"]."+field_key).remove();window.lodash.pullAllBy(new_filter_labels,[{id:option_id}],"id");}});//watch bool checkboxes
$('#filter-modal .boolean_options input').on("change",function(){var field_key=$(this).data('field');var option_id=$(this).val();var label=$(this).data('label');if($(this).is(":checked")){var _field=window.lodash.get(list_settings,"post_type_settings.fields."+field_key);new_filter_labels.push({id:$(this).val(),name:_field.name+": "+label,field:field_key});selected_filters.append("<span class=\"current-filter "+window.lodash.escape(field_key)+"\" data-id=\""+window.lodash.escape(option_id)+"\">"+window.lodash.escape(_field.name)+":"+window.lodash.escape(label)+"</span>");}else{$(".current-filter[data-id=\""+$(this).val()+"\"]."+field_key).remove();window.lodash.pullAllBy(new_filter_labels,[{id:option_id}],"id");}});$('#filter-modal .dt_date_picker').datepicker({constrainInput:false,dateFormat:'yy-mm-dd',onSelect:function onSelect(date){var id=$(this).data('field');var delimiter=$(this).data('delimit');var delimiter_label=list_settings.translations["range_"+delimiter];var field_name=window.lodash.get(list_settings,"post_type_settings.fields."+id+".name",id);//remove existing filters
window.lodash.pullAllBy(new_filter_labels,[{id:id+"_"+delimiter}],"id");$(".current-filter[data-id=\""+id+"_"+delimiter+"\"]").remove();//add new filters
new_filter_labels.push({id:id+"_"+delimiter,name:field_name+" "+delimiter_label+": "+date,field:id,date:date});selected_filters.append("\n        <span class=\"current-filter "+id+"_"+delimiter+"\"\n              data-id=\""+id+"_"+delimiter+"\">\n                "+field_name+" "+delimiter_label+":"+date+"\n        </span>\n      ");},changeMonth:true,changeYear:true});$('#filter-modal .clear-date-picker').on('click',function(){var id=$(this).data('for');$("#filter-modal #"+id).datepicker('setDate',null);window.lodash.pullAllBy(new_filter_labels,[{id:""+id}],"id");$(".current-filter[data-id=\""+id+"\"]").remove();});//save the filter in the user meta
$("#confirm-filter-save").on('click',function(){var filterName=$('#filter-name').val();var filter=window.lodash.find(custom_filters,{ID:filter_to_save});filter.name=window.lodash.escape(filterName);filter.tab='custom';if(filter.query){list_settings.filters.filters.push(filter);API.save_filters(list_settings.post_type,filter).then(function(){$(".custom-filters [class*=\"list-view "+filter_to_save).remove();setup_filters();var active_tab=$('.accordion-item.is-active ').data('id');if(active_tab!=='custom'){$("#list-filter-tabs [data-id='custom'] a").click();}$("input[name=\"view\"][value=\"saved-filters\"][data-id='"+filter_to_save+"']").prop('checked',true);get_records_for_current_filter();$('#filter-name').val("");}).catch(function(err){console.error(err);});}});//delete a filter
$("#confirm-filter-delete").on('click',function(){var filter=window.lodash.find(list_settings.filters.filters,{ID:filter_to_delete});if(filter&&(filter.visible===true||filter.visible==='1')){filter.visible=false;API.save_filters(list_settings.post_type,filter).then(function(){window.lodash.pullAllBy(list_settings.filters.filters,[{ID:filter_to_delete}],"ID");setup_filters();$("#list-filter-tabs [data-id='custom'] a").click();}).catch(function(err){console.error(err);});}else{API.delete_filter(list_settings.post_type,filter_to_delete).then(function(){window.lodash.pullAllBy(list_settings.filters.filters,[{ID:filter_to_delete}],"ID");setup_filters();check_first_filter();get_records_for_current_filter();}).catch(function(err){console.error(err);});}});$('#advanced_search').on('click',function(){$('#advanced_search_picker').toggle();});$('#advanced_search_mobile').on('click',function(){$('#advanced_search_picker_mobile').toggle();});$('#advanced_search_reset').on('click',function(){var fields_to_search=[];window.SHAREDFUNCTIONS.save_json_cookie('fields_to_search',fields_to_search,list_settings.post_type);//clear all checkboxes
$('#advanced_search_picker ul li input:checked').each(function(index){$(this).prop('checked',false);});$('#search').click();});$('#advanced_search_reset_mobile').on('click',function(){var fields_to_search=[];window.SHAREDFUNCTIONS.save_json_cookie('fields_to_search',fields_to_search,list_settings.post_type);//clear all checkboxes
$('#advanced_search_picker_mobile ul li input:checked').each(function(index){$(this).prop('checked',false);});$('#search-mobile').click();});$('#save_advanced_search_choices').on("click",function(){var fields_to_search=[];$('#advanced_search_picker ul li input:checked').each(function(index){fields_to_search.push($(this).val());});window.SHAREDFUNCTIONS.save_json_cookie('fields_to_search',fields_to_search,list_settings.post_type);if($("#search-query").val()!==""){$('#search').click();}else{$('#advanced_search_picker').hide();}});$('#save_advanced_search_choices_mobile').on("click",function(){var fields_to_search=[];$('#advanced_search_picker_mobile ul li input:checked').each(function(index){fields_to_search.push($(this).val());});window.SHAREDFUNCTIONS.save_json_cookie('fields_to_search',fields_to_search,list_settings.post_type);if($("#search-query-mobile").val()!==""){$('#search-mobile').click();}else{$('#advanced_search_picker_mobile').hide();}});$("#search").on("click",function(){var searchText=$("#search-query").val();var fieldsToSearch=[];$('#advanced_search_picker ul li input:checked').each(function(index){fieldsToSearch.push($(this).val());});window.SHAREDFUNCTIONS.save_json_cookie('fields_to_search',fieldsToSearch,list_settings.post_type);if(fieldsToSearch.length>0){$('.advancedSearch-count').text(fieldsToSearch.length).css('display','inline-block');}else{$('.advancedSearch-count').text('fields_to_search.length').hide();}var query={text:searchText};if(fieldsToSearch.length!==0){query.fields_to_search=fieldsToSearch;}var labels=[{id:"search",name:searchText,field:"search"}];add_custom_filter(searchText,"search",query,labels);$('#advanced_search_picker').hide();});$("#search-mobile").on("click",function(){var searchText=window.lodash.escape($("#search-query-mobile").val());var fieldsToSearch=[];$('#advanced_search_picker_mobile ul li input:checked').each(function(index){fieldsToSearch.push($(this).val());});window.SHAREDFUNCTIONS.save_json_cookie('fields_to_search',fieldsToSearch,list_settings.post_type);if(fieldsToSearch.length>0){$('.advancedSearch-count').text(fieldsToSearch.length).css('display','inline-block');}else{$('.advancedSearch-count').text('fields_to_search.length').hide();}var query={text:searchText};if(fieldsToSearch.length!==0){query.fields_to_search=fieldsToSearch;}var labels=[{id:"search",name:searchText,field:"search"}];add_custom_filter(searchText,"search",query,labels);$('#advanced_search_picker_mobile').hide();});$('.search-input').on('keyup',function(e){if(e.keyCode===13){$("#search").trigger("click");}});$('.search-input-mobile').on('keyup',function(e){if(e.keyCode===13){$("#search-mobile").trigger("click");}});//toggle show search input on mobile
$("#open-search").on("click",function(){$(".hideable-search").toggle();});/***
   * Bulk Edit
   */$('#bulk_edit_controls').on('click',function(){$('#bulk_edit_picker').toggle();$('#records-table').toggleClass('bulk_edit_on');});$('#bulk_edit_seeMore').on('click',function(){$('#bulk_more').toggle();$('#bulk_edit_seeMore').children().toggle();});function bulk_edit_checkbox_event(){$("tbody tr td.bulk_edit_checkbox").on('click',function(e){e.stopImmediatePropagation();bulk_edit_count();});}$('#bulk_edit_master').on('click',function(e){e.stopImmediatePropagation();var checked=$(this).children('input').is(':checked');$('.bulk_edit_checkbox input').each(function(){$(this).prop('checked',checked);bulk_edit_count();});});/**
   * Bulk_Assigned_to
   */var bulk_edit_submit_button=$('#bulk_edit_submit');bulk_edit_submit_button.on('click',function(e){bulk_edit_submit();});function bulk_edit_submit(){$('#bulk_edit_submit-spinner').addClass('active');var allInputs=$('#bulk_edit_picker input, #bulk_edit_picker select, #bulk_edit_picker .button').not('#bulk_share');var multiSelectInputs=$('#bulk_edit_picker .dt_multi_select');var shareInput=$('#bulk_share');var updatePayload={};var sharePayload=void 0;allInputs.each(function(){var inputData=$(this).data();$.each(inputData,function(key,value){if(key.includes('bulk_key_')&&value){var field_key=key.replace('bulk_key_','');if(field_key){updatePayload[field_key]=value;}}});});if(window.location_data){updatePayload['location_grid_meta']=window.location_data.location_grid_meta;}var multiSelectUpdatePayload={};multiSelectInputs.each(function(){var inputData=$(this).data();$.each(inputData,function(key,value){if(key.includes('bulk_key_')&&value){var field_key=key.replace('bulk_key_','');if(!multiSelectUpdatePayload[field_key]){multiSelectUpdatePayload[field_key]={'values':[]};}multiSelectUpdatePayload[field_key].values.push(value.values);}});});var multiSelectKeys=Object.keys(multiSelectUpdatePayload);multiSelectKeys.forEach(function(key,index){console.log(key+": "+multiSelectUpdatePayload[key]);updatePayload[key]=multiSelectUpdatePayload[key];});shareInput.each(function(){sharePayload=$(this).data('bulk_key_share');});var queue=[];var count=0;$('.bulk_edit_checkbox input').each(function(){if(this.checked&&this.id!=='bulk_edit_master_checkbox'){var postId=parseInt($(this).val());queue.push(postId);}});process(queue,10,doEach,doDone,updatePayload,sharePayload);}function bulk_edit_count(){var bulk_edit_total_checked=$('.bulk_edit_checkbox:not(#bulk_edit_master) input:checked').length;var bulk_edit_submit_button_text=$('#bulk_edit_submit_text');if(bulk_edit_total_checked==0){bulk_edit_submit_button_text.text("Update "+list_settings.post_type);}else{bulk_edit_submit_button_text.text("Update "+bulk_edit_total_checked+" "+list_settings.post_type);}}var bulk_edit_picker_checkboxes=$('#bulk_edit_picker .update-needed');bulk_edit_picker_checkboxes.on('click',function(e){if($(this).is(':checked')){$(this).data('bulk_key_requires_update',true);}});var bulk_edit_picker_select_field=$('#bulk_edit_picker select');bulk_edit_picker_select_field.on('change',function(e){var field_key=this.id.replace('bulk_','');$(this).data("bulk_key_"+field_key,this.value);});var bulk_edit_picker_button_groups=$('#bulk_edit_picker .select-button');bulk_edit_picker_button_groups.on('click',function(e){var field_key=$(this).data('field-key').replace('bulk_','');var optionKey=$(this).attr('id');var fieldValue={};fieldValue.values={value:optionKey};$(this).addClass('selected-select-button');$(this).data("bulk_key_"+field_key,fieldValue);});//Bulk Update Queue
function process(q,num,fn,done,update,share){// remove a batch of items from the queue
var items=q.splice(0,num),count=items.length;// no more items?
if(!count){// exec done callback if specified
done&&done();// quit
return;}// loop over each item
for(var i=0;i<count;i++){// call callback, passing item and
// a "done" callback
fn(items[i],function(){// when done, decrement counter and
// if counter is 0, process next batch
--count||process(q,num,fn,done,update,share);},update,share);}}// a per-item action
function doEach(item,done,update,share){var promises=[];if(Object.keys(update).length){promises.push(API.update_post(list_settings.post_type,item,update).catch(function(err){console.error(err);}));}if(share){share.forEach(function(value){promises.push(API.add_shared(list_settings.post_type,item,value).catch(function(err){console.error(err);}));});}Promise.all(promises).then(function(){done();});}function doDone(){$('#bulk_edit_submit-spinner').removeClass('active');window.location.reload();}var bulk_assigned_to_input=$(".js-typeahead-bulk_assigned_to");$.typeahead({input:'.js-typeahead-bulk_assigned_to',minLength:0,maxItem:0,accent:true,searchOnFocus:true,source:TYPEAHEADS.typeaheadUserSource(),templateValue:"{{name}}",template:function template(query,item){return"<div class=\"assigned-to-row\" dir=\"auto\">\n        <span>\n            <span class=\"avatar\"><img style=\"vertical-align: text-bottom\" src=\"{{avatar}}\"/></span>\n            "+window.lodash.escape(item.name)+"\n        </span>\n        "+(item.status_color?"<span class=\"status-square\" style=\"background-color: "+window.lodash.escape(item.status_color)+";\">&nbsp;</span>":'')+"\n        "+(item.update_needed&&item.update_needed>0?"<span>\n          <img style=\"height: 12px;\" src=\""+window.lodash.escape(window.wpApiShare.template_dir)+"/dt-assets/images/broken.svg\"/>\n          <span style=\"font-size: 14px\">"+window.lodash.escape(item.update_needed)+"</span>\n        </span>":'')+"\n      </div>";},dynamic:true,hint:true,emptyTemplate:window.lodash.escape(window.wpApiShare.translations.no_records_found),callback:{onClick:function onClick(node,a,item){node.data('bulk_key_assigned_to',"user-"+item.ID);},onResult:function onResult(node,query,result,resultCount){var text=TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$('#bulk_assigned_to-result-container').html(text);},onHideLayout:function onHideLayout(){$('.bulk_assigned_to-result-container').html("");},onReady:function onReady(){}}});/**
   * Bulk share
  */$.typeahead({input:'#bulk_share',minLength:0,maxItem:0,accent:true,searchOnFocus:true,source:TYPEAHEADS.typeaheadUserSource(),templateValue:"{{name}}",dynamic:true,multiselect:{matchOn:["ID"],callback:{onCancel:function onCancel(node,item){$(node).removeData("bulk_key_bulk_share");$('#share-result-container').html("");}}},callback:{onClick:function onClick(node,a,item,event){var shareUserArray=void 0;if(node.data('bulk_key_share')){shareUserArray=node.data('bulk_key_share');}else{shareUserArray=[];}shareUserArray.push(item.ID);node.data("bulk_key_share",shareUserArray);},onResult:function onResult(node,query,result,resultCount){if(query){var text=window.TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$('#share-result-container').html(text);}},onHideLayout:function onHideLayout(){$('#share-result-container').html("");}}});/**
 * Bulk Typeahead
 */var field_settings=window.list_settings.post_type_settings.fields;$('#bulk_edit_picker .dt_typeahead').each(function(key,el){var field_id=$(el).attr('id').replace('_connection','').replace('bulk_','');var element_id=$(el).attr('id').replace('_connection','');if(element_id!=="bulk_share"){var listing_post_type=window.lodash.get(window.list_settings.post_type_settings.fields[field_id],"post_type",'contacts');$.typeahead({input:".js-typeahead-"+element_id,minLength:0,accent:true,maxItem:30,searchOnFocus:true,template:window.TYPEAHEADS.contactListRowTemplate,source:window.TYPEAHEADS.typeaheadPostsSource(listing_post_type,{field_key:field_id}),display:"name",templateValue:"{{name}}",dynamic:true,multiselect:{matchOn:["ID"],data:'',callback:{onCancel:function onCancel(node,item){$(node).removeData("bulk_key_"+field_id);}},href:window.wpApiShare.site_url+("/"+listing_post_type+"/{{ID}}")},callback:{onClick:function onClick(node,a,item,event){var multiUserArray=void 0;if(node.data("bulk_key_"+field_id)){multiUserArray=node.data("bulk_key_"+field_id).values;}else{multiUserArray=[];}multiUserArray.push({"value":item.ID});node.data("bulk_key_"+field_id,{values:multiUserArray});this.addMultiselectItemLayout(item);event.preventDefault();this.hideLayout();this.resetInput();//masonGrid.masonry('layout')
},onResult:function onResult(node,query,result,resultCount){var text=TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$("#"+element_id+"-result-container").html(text);},onHideLayout:function onHideLayout(event,query){if(!query){$("#"+element_id+"-result-container").empty();}//masonGrid.masonry('layout')
},onShowLayout:function onShowLayout(){//masonGrid.masonry('layout')
}}});}});$('#bulk_edit_picker .dt_location_grid').each(function(){var field_id='location_grid';var typeaheadTotals={};$.typeahead({input:'.js-typeahead-location_grid',minLength:0,accent:true,searchOnFocus:true,maxItem:20,dropdownFilter:[{key:'group',value:'focus',template:window.lodash.escape(window.wpApiShare.translations.regions_of_focus),all:window.lodash.escape(window.wpApiShare.translations.all_locations)}],source:{focus:{display:"name",ajax:{url:window.wpApiShare.root+'dt/v1/mapping_module/search_location_grid_by_name',data:{s:"{{query}}",filter:function filter(){// return window.lodash.get(window.Typeahead['.js-typeahead-location_grid'].filters.dropdown, 'value', 'all')
}},beforeSend:function beforeSend(xhr){xhr.setRequestHeader('X-WP-Nonce',window.wpApiShare.nonce);},callback:{done:function done(data){if(typeof typeaheadTotals!=="undefined"){typeaheadTotals.field=data.total;}return data.location_grid;}}}}},display:"name",templateValue:"{{name}}",dynamic:true,multiselect:{matchOn:["ID"],data:'',callback:{onCancel:function onCancel(node,item){$(node).removeData("bulk_key_"+field_id);}}},callback:{onClick:function onClick(node,a,item,event){// $(`#${element_id}-spinner`).addClass('active');
node.data("bulk_key_"+field_id,{values:[{"value":item.ID}]});},onReady:function onReady(){this.filters.dropdown={key:"group",value:"focus",template:window.lodash.escape(window.wpApiShare.translations.regions_of_focus)};this.container.removeClass("filter").find("."+this.options.selector.filterButton).html(window.lodash.escape(window.wpApiShare.translations.regions_of_focus));},onResult:function onResult(node,query,result,resultCount){resultCount=typeaheadTotals.location_grid;var text=TYPEAHEADS.typeaheadHelpText(resultCount,query,result);$('#location_grid-result-container').html(text);},onHideLayout:function onHideLayout(){$('#location_grid-result-container').html("");}}});});$('button.follow').on("click",function(){var following=!($(this).data('value')==="following");$(this).data("value",following?"following":"");$(this).html(following?"Unfollow":"Follow");$(this).toggleClass("hollow");var follow={values:[{value:current_user_id,delete:!following}]};var unfollow={values:[{value:current_user_id,delete:following}]};$(this).data('bulk_key_follow',follow);$(this).data('bulk_key_unfollow',unfollow);});$('#bulk_edit_picker input.text-input').change(function(){var val=$(this).val();var field_key=this.id.replace('bulk_','');$(this).data("bulk_key_"+field_key,val);});$('#bulk_edit_picker .dt_textarea').change(function(){var val=$(this).val();var field_key=this.id.replace('bulk_','');$(this).data("bulk_key_"+field_key,val);});$('#bulk_edit_picker .dt_date_picker').datepicker({constrainInput:false,dateFormat:'yy-mm-dd',onClose:function onClose(date){if(document.querySelector('#group-details-edit-modal')&&document.querySelector('#group-details-edit-modal').contains(this)){// do nothing
}else{date=window.SHAREDFUNCTIONS.convertArabicToEnglishNumbers(date);if(!$(this).val()){date=" ";//null;
}var formattedDate=moment.utc(date).unix();var field_key=this.id.replace('bulk_','');$(this).data("bulk_key_"+field_key,formattedDate);}},changeMonth:true,changeYear:true,yearRange:"1900:2050"}).each(function(){if(this.value&&moment.unix(this.value).isValid()){this.value=window.SHAREDFUNCTIONS.formatDate(this.value);}});var mcleardate=$("#bulk_edit_picker .clear-date-button");mcleardate.click(function(){var input_id=this.dataset.inputid;var date=null;// $(`#${input_id}-spinner`).addClass('active')
var field_key=this.id.replace('bulk_','');$(this).removeData("bulk_key_"+field_key);$("#"+input_id).val("");});$('#bulk_edit_picker select.select-field').change(function(e){var val=$(e.currentTarget).val();if(val==="paused"){$('#reason-paused-options').parent().toggle();}var field_key=e.currentTarget.id.replace('bulk_','');$(e.currentTarget).data("bulk_key_"+field_key,val);});$('#bulk_edit_picker input.number-input').on("blur",function(){var id=$(this).attr('id');var val=$(this).val();var field_key=this.id.replace('bulk_','');$(this).data("bulk_key_"+field_key,val);});$('#bulk_edit_picker .dt_contenteditable').on('blur',function(){var id=$(this).attr('id');var val=$(this).html();var field_key=this.id.replace('bulk_','');$(this).data("bulk_key_"+field_key,val);});})(window.jQuery,window.list_settings,window.Foundation);